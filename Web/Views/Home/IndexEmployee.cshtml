@using Framework.Utils
@using Framework.Common
@model KO.Web.Models.Order.OrderViewModel

@section scripts
{
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <script type="text/javascript" src="~/js/pages/home/index.js" asp-append-version="true"></script>
    <script type="text/javascript">
        vueAppParams.data.model =@Html.Raw(Model.ToJsonModel())
    </script>


}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />
<link href="~/css/selfResto.css" rel="stylesheet" />

@if (UserUtils.UserPermission(Context.User, Constants.ADMINISTRATOR))
{

    <template>
        <v-container fluid>
            <v-row>
                <v-col v-for="item in tables"
                       :key="item.Id"
                       :cols="2">
                    <v-card>
                        <v-img src="@Url.Content("/images/backgroundMesaAdmin.jpg")"
                               class="white--text align-end"
                               height="100px">
                            <v-card-title>
                                <label>Mesa {{item.number}}</label>
                                <v-spacer></v-spacer>
                                <v-avatar v-if="item.closed" color="white" icon>
            <v-icon large >person_off</v-icon>
        </v-avatar>  <!--Cerrada-->
                                <v-avatar v-if="!item.closed" color="white" icon>
            <v-icon large color="green lighten-1">mdi-chef-hat</v-icon>

        </v-avatar> <!--Abierta-->
                                @*<v-avatar color="white" icon>
                                    <v-icon large color="red" class="material-icons">paid</v-icon>

                                </v-avatar>*@<!--Pagando-->
                            </v-card-title>
                        </v-img>
                        <v-card-title class="py-1">
                            <label style="font-size:13px">
                                {{jsglobals.Waiter}}: <strong>{{item.waiterName}}</strong>
                            </label>
                        </v-card-title>
                        <v-card-title class="py-1">
                            <label style="font-size:13px">
                                {{jsglobals.WaiterBackUp}}: {{item.waiterBackUpName}}
                            </label>
                        </v-card-title>

                        @*<v-card-actions>
                            <v-btn color="red lighten-2" v-on:click="SeeDetail">{{jsglobals.SeeDetail}}</v-btn>
                        </v-card-actions>*@
                    </v-card>
                </v-col>
            </v-row>
        </v-container>
    </template>
}


@if (UserUtils.UserPermission(Context.User, Constants.WAITER))
{

    <template>
        <v-container fluid>
            <v-row>
                <v-col v-for="n in 5"
                       :key="n"
                       :cols="4">
                    <v-card>
                        <v-img src="@Url.Content("/images/backgroundMesaMozo.jpg")"
                               class="white--text align-end"
                               gradient="to bottom, rgba(120,178,196,.2), rgba(103,206,240,.6)"
                               height="200px">
                            <v-card-title>Mesa {{n}}</v-card-title>
                        </v-img>

                        <v-card-actions>
                            <v-btn color="red lighten-2" v-on:click="SeeDetail">{{jsglobals.SeeDetail}}</v-btn>
                            <v-spacer></v-spacer>

                            <v-btn icon class="mx-5">
                                <v-icon large class="material-icons">notifications_active</v-icon>
                            </v-btn>

                            <v-btn icon class="mx-5">
                                <v-icon large class="material-icons">liquor</v-icon>
                            </v-btn>

                            <v-btn icon class="mx-5">
                                <v-icon large>mdi-chef-hat</v-icon>
                            </v-btn>

                            <v-btn icon class="mx-5">
                                <v-icon large class="material-icons">paid</v-icon>
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-col>
            </v-row>
        </v-container>
    </template>
}

@if (UserUtils.UserPermission(Context.User, Constants.KITCHEN))
{
    <template>
        <v-row dense class="mx-15" style="height: 612px !important;min-height: 612px !important;max-height: 612px !important;">
            <template>
                <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <v-col v-for="(elem,index) in orders"
                                   v-if="index <4"
                                   :key="elem.id"
                                   elevation="10"
                                   :cols="3"
                                   style="margin-top:-6vh; vertical-align:top !important"
                                   class="d-inline-block w-50">

                                <div class="text-center rope">
                                    <img width="108%" src="@Url.Content("/images/ropeTransparent.png")" />
                                </div>
                                <div class="text-center clip">
                                    <img width="50" src="@Url.Content("/images/clipTransparent.png")" />
                                </div>
                                <v-card>
                                    <v-card-title class="py-0" style="justify-content:center">
                                        &nbsp;
                                    </v-card-title>
                                    <v-card-title class="py-1">
                                        <label style="font-size:13px">
                                            {{jsglobals.Waiter}}: {{elem.waiterName}}
                                        </label>
                                        <v-spacer></v-spacer>
                                        {{jsglobals.Table}} {{elem.tableNumber}}
                                    </v-card-title>
                                    <v-card-title class="pt-0">
                                        <label style="font-size:14px">{{jsglobals.Request}}: {{elem.requestedTimeString}}</label>
                                        <v-spacer></v-spacer>
                                        <v-chip outlined :color="elem.cronoWarning">{{elem.tiempoEnCocina}}</v-chip>
                                    </v-card-title>
                                    <template>
                                        <label color="gray">&nbsp;&nbsp;******************************************</label>
                                        <v-card-text style="font-size:16px;color:black" class="text-center pa-0">
                                            <v-list v-if="elem.orderDetails.some(o=>o.menuItemCategoryId == 1)">
                                                <label name="entradas"><strong>- - - ENTRADAS - - - </strong></label>
                                                <v-list-item v-for="item in elem.orderDetails" v-if="item.menuItemCategoryId == 1"
                                                             :key="item.id"
                                                             style="min-height:25px !important;border-bottom:0.5px solid lightgray">
                                                    <v-list-item-title style="color:red" v-if="item.stateTypeId == 1" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color:blue" v-if="item.stateTypeId == 2" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: green; text-decoration: line-through" v-if="item.stateTypeId >= 3" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-subtitle class="text-right" style="max-width:60px !important">
                                                        <v-icon v-if="item.stateTypeId == 1" color="red" v-on:click="changeItemState(elem.id, item.id, 2)">play_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 2 " color="primary" v-on:click="changeItemState(elem.id, item.id, 3)">stop_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 3" color="green">done</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 4" color="green">done_all</v-icon>
                                                        <v-icon v-if="item.stateTypeId > 1" v-on:click="changeBack(elem.id, item.id)">undo</v-icon>
                                                    </v-list-item-subtitle>
                                                </v-list-item>
                                            </v-list>

                                            <v-list v-if="elem.orderDetails.some(o=>(o.menuItemCategoryId > 1 && o.menuItemCategoryId < 7))">
                                                <label><strong>- - - PLATOS - - - </strong></label>
                                                <v-list-item v-for="item in elem.orderDetails" v-if="(item.menuItemCategoryId > 1 && item.menuItemCategoryId < 7)"
                                                             :key="item.id"
                                                             style="min-height: 25px !important; border-bottom: 0.5px solid lightgray">
                                                    <v-list-item-title name="platos" style="color:red" v-if="item.stateTypeId == 1" class="text-left">
                                                        {{item.menuItemName}}<span v-if="item.relatedMenuItemId != null">con {{item.relatedMenuItemName}}</span>
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: blue" v-if="item.stateTypeId == 2" class="text-left">
                                                        {{item.menuItemName}}<span v-if="item.relatedMenuItemId != null">con {{item.relatedMenuItemName}}</span>
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: green; text-decoration: line-through" v-if="item.stateTypeId >= 3" class="text-left">
                                                        {{item.menuItemName}}<span v-if="item.relatedMenuItemId != null">con {{item.relatedMenuItemName}}</span>
                                                    </v-list-item-title>
                                                    <v-list-item-subtitle class="text-right" style="max-width:60px !important">
                                                        <v-icon v-if="item.stateTypeId == 1" color="red" v-on:click="changeItemState(elem.id, item.id, 2)">play_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 2" color="primary" v-on:click="changeItemState(elem.id, item.id, 3)">stop_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 3" color="green">done</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 4" color="green">done_all</v-icon>
                                                        <v-icon v-if="item.stateTypeId > 1" v-on:click="changeBack(elem.id, item.id)">undo</v-icon>
                                                    </v-list-item-subtitle>
                                                </v-list-item>
                                            </v-list>

                                            <v-list v-if="elem.orderDetails.some(o=>o.menuItemCategoryId == 7)">
                                                <label><strong>- - - POSTRES - - - </strong></label>
                                                <v-list-item v-for="item in elem.orderDetails" v-if="item.menuItemCategoryId == 7"
                                                             :key="item.id"
                                                             style="min-height: 25px !important; border-bottom: 0.5px solid lightgray">
                                                    <v-list-item-title name="postres" style="color:red" v-if="item.stateTypeId == 1" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color:blue" v-if="item.stateTypeId == 2" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: green; text-decoration: line-through" v-if="item.stateTypeId >= 3" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-subtitle class="text-right" style="max-width:60px !important">
                                                        <v-icon v-if="item.stateTypeId == 1" color="red" v-on:click="changeItemState(elem.id, item.id, 2)">play_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 2" color="primary" v-on:click="changeItemState(elem.id, item.id, 3)">stop_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 3" color="green">done</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 4" color="green">done_all</v-icon>
                                                        <v-icon v-if="item.stateTypeId > 1" v-on:click="changeBack(elem.id, item.id)">undo</v-icon>
                                                    </v-list-item-subtitle>
                                                </v-list-item>
                                            </v-list>
                                        </v-card-text>
                                    </template>
                            </v-col>
                        </div>
                        <div v-for="n in Math.ceil(orders.length / 4) - 1" class="carousel-item">
                            <v-col v-for="(elem,index) in orders"
                                   v-if="n > 0 && index < n*4+4 && index >=n*4"
                                   :key="elem.id"
                                   elevation="10"
                                   :cols="3"
                                   style="margin-top:-6vh;vertical-align:top !important"
                                   class="d-inline-block w-50">
                                <div class="text-center rope">
                                    <img width="108%" src="@Url.Content("/images/ropeTransparent.png")" />
                                </div>
                                <div class="text-center clip">
                                    <img width="50" src="@Url.Content("/images/clipTransparent.png")" />
                                </div>
                                <v-card>
                                    <v-card-title class="py-0" style="justify-content:center">
                                        &nbsp;
                                    </v-card-title>
                                    <v-card-title class="py-1">
                                        <label style="font-size:13px">
                                            {{jsglobals.Waiter}}: {{elem.waiterName}}
                                        </label>
                                        <v-spacer></v-spacer>
                                        {{jsglobals.Table}} {{elem.tableNumber}}
                                    </v-card-title>
                                    <v-card-title class="pt-0">
                                        <label style="font-size:14px">{{jsglobals.Request}}: {{elem.requestedTimeString}}</label>
                                        <v-spacer></v-spacer>
                                        <v-chip outlined :color="elem.cronoWarning">{{elem.tiempoEnCocina}}</v-chip>
                                    </v-card-title>
                                    <template>
                                        <label color="gray">&nbsp;&nbsp;********************************************</label>
                                        <v-card-text style="font-size:16px;color:black" class="text-center pa-0">
                                            <v-list v-if="elem.orderDetails.some(o=>o.menuItemCategoryId == 1)">
                                                <label name="entradas"><strong>- - - ENTRADAS - - - </strong></label>
                                                <v-list-item v-for="item in elem.orderDetails" v-if="item.menuItemCategoryId == 1"
                                                             :key="item.id"
                                                             style="min-height:25px !important;border-bottom:0.5px solid lightgray">
                                                    <v-list-item-title style="color:red" v-if="item.stateTypeId == 1" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color:blue" v-if="item.stateTypeId == 2" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: green; text-decoration: line-through" v-if="item.stateTypeId >= 3" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-subtitle class="text-right" style="max-width:60px !important">
                                                        <v-icon v-if="item.stateTypeId == 1" color="red" v-on:click="changeItemState(elem.id, item.id, 2)">play_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 2 " color="primary" v-on:click="changeItemState(elem.id, item.id, 3)">stop_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 3" color="green">done</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 4" color="green">done_all</v-icon>
                                                        <v-icon v-if="item.stateTypeId > 1" v-on:click="changeBack(elem.id, item.id)">undo</v-icon>
                                                    </v-list-item-subtitle>
                                                </v-list-item>
                                            </v-list>

                                            <v-list v-if="elem.orderDetails.some(o=>(o.menuItemCategoryId > 1 && o.menuItemCategoryId < 7))">
                                                <label><strong>- - - PLATOS - - - </strong></label>
                                                <v-list-item v-for="item in elem.orderDetails" v-if="(item.menuItemCategoryId > 1 && item.menuItemCategoryId < 7)"
                                                             :key="item.id"
                                                             style="min-height: 25px !important; border-bottom: 0.5px solid lightgray">
                                                    <v-list-item-title name="platos" style="color:red" v-if="item.stateTypeId == 1" class="text-left">
                                                        {{item.menuItemName}}<span v-if="item.relatedMenuItemId != null">con {{item.relatedMenuItemName}}</span>
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: blue" v-if="item.stateTypeId == 2" class="text-left">
                                                        {{item.menuItemName}}<span v-if="item.relatedMenuItemId != null">con {{item.relatedMenuItemName}}</span>
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: green; text-decoration: line-through" v-if="item.stateTypeId >= 3" class="text-left">
                                                        {{item.menuItemName}}<span v-if="item.relatedMenuItemId != null">con {{item.relatedMenuItemName}}</span>
                                                    </v-list-item-title>
                                                    <v-list-item-subtitle class="text-right" style="max-width:60px !important">
                                                        <v-icon v-if="item.stateTypeId == 1" color="red" v-on:click="changeItemState(elem.id, item.id, 2)">play_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 2" color="primary" v-on:click="changeItemState(elem.id, item.id, 3)">stop_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 3" color="green">done</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 4" color="green">done_all</v-icon>
                                                        <v-icon v-if="item.stateTypeId > 1" v-on:click="changeBack(elem.id, item.id)">undo</v-icon>
                                                    </v-list-item-subtitle>
                                                </v-list-item>
                                            </v-list>

                                            <v-list v-if="elem.orderDetails.some(o=>o.menuItemCategoryId == 7)">
                                                <label><strong>- - - POSTRES - - - </strong></label>
                                                <v-list-item v-for="item in elem.orderDetails" v-if="item.menuItemCategoryId == 7"
                                                             :key="item.id"
                                                             style="min-height: 25px !important; border-bottom: 0.5px solid lightgray">
                                                    <v-list-item-title name="postres" style="color:red" v-if="item.stateTypeId == 1" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color:blue" v-if="item.stateTypeId == 2" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-title style="color: green; text-decoration: line-through" v-if="item.stateTypeId >= 3" class="text-left">
                                                        {{item.menuItemName}}
                                                    </v-list-item-title>
                                                    <v-list-item-subtitle class="text-right" style="max-width:60px !important">
                                                        <v-icon v-if="item.stateTypeId == 1" color="red" v-on:click="changeItemState(elem.id, item.id, 2)">play_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 2" color="primary" v-on:click="changeItemState(elem.id, item.id, 3)">stop_circle</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 3" color="green">done</v-icon>
                                                        <v-icon v-if="item.stateTypeId == 4" color="green">done_all</v-icon>
                                                        <v-icon v-if="item.stateTypeId > 1" v-on:click="changeBack(elem.id, item.id)">undo</v-icon>
                                                    </v-list-item-subtitle>
                                                </v-list-item>
                                            </v-list>
                                        </v-card-text>
                                    </template>
                                </v-card>
                            </v-col>
                        </div>

                    </div>
                    <div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true" style="border-radius:5px; background-color: rgb(189, 100, 118) !important; margin-left: -300px !important"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                    </div>
                    <div>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true" style="border-radius: 5px; background-color: rgb(189, 100, 118) !important; margin-right: -300px !important"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
            </template>
        </v-row>
    </template>

}








